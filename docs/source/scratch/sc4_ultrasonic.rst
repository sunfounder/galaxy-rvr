.. note:: 

    你好，欢迎加入 SunFounder 树莓派、Arduino 和 ESP32 爱好者社区！在这里，你可以与其他爱好者一起深入探索树莓派、Arduino 和 ESP32。

    **为什么要加入？**

    - **专家支持**：通过社区和团队的帮助，解决售后问题和技术挑战。
    - **学习与分享**：交流技巧和教程，提升自己的技术水平。
    - **独家预览**：抢先体验新产品发布和独家内容。
    - **专属折扣**：享受最新产品的专属优惠。
    - **节日促销与赠品**：参与赠品活动和节日促销。

    👉 准备好与我们一起探索和创造了吗？点击 [|link_sf_facebook|] 立即加入！



第四课 超声波
===========================

在上一次的冒险中，我们给火星探测车装备了两侧的“眼睛”，搭建了一个基本的避障系统。但是，它正前方还有一个盲区——这也是我们今天要解决的挑战！

今天，在这节课中，我们将赋予我们的探测车新的“视觉”能力。我们将安装一个超声波传感器模块，作为探测车的“中央眼睛”，帮助探测车感知正前方的障碍物。

我们将深入了解超声波的工作原理，并探索它如何增强探测车在复杂地形中的导航能力。通过这个新模块，我们的火星探测车将变得更加灵敏和灵活，准备迎接更加复杂的探索任务。

加入我们，一起踏上这段激动人心的STEAM之旅，让我们的火星探测车更擅长探索未知领域吧！

.. raw:: html

   <video width="600" loop autoplay muted>
      <source src="../_static/video/ultrasonic_avoid.mp4" type="video/mp4">
      Your browser does not support the video tag.
   </video>


学习目标
-------------------------

* 理解超声波测距原理。
* 学习如何使用 Mammoth 编程 APP 和超声波模块进行距离测量。
* 实践应用超声波模块进行 GalaxyRVR 的避障操作。


所需材料
-----------

* 智能手机或平板电脑
* Mammoth 编程 APP
* GalaxyRVR


探索超声波模块
--------------------------------------------

让我们来认识一下 HC-SR04，这款强大的超声波测距传感器。这是一个小巧的设备，能够精确测量从 2 cm 到 400 cm 的距离，而且完全不需要接触物体！是不是很神奇？就像拥有一种超级能力！它能通过声波“看到”距离，就像蝙蝠夜间导航一样。

它通过四个引脚，或者说四个“超能力”来完成它的任务：

.. image:: ../img/ultrasonic_pic.png
    :width: 400
    :align: center

* **TRIG（触发脉冲输入）** - 它是超级英雄的启动按钮，告诉它：“嘿，是时候发射超声波啦！”
* **ECHO（回声脉冲输出）** - 这是超级英雄接收回声的方式。
* **VCC** - 即使是超级英雄也需要能量，我们将其连接到 5V 电源。
* **GND** - 这是地线连接，就像超级英雄需要保持与现实世界的联系！

想象一下我们的超级英雄 HC-SR04 超声波传感器在山谷中玩回声游戏。

.. image:: ../img/ultrasonic_prin.jpg
    :width: 800

* 首先，超级英雄的大脑 MCU 通过发送至少 10 微秒的高电平信号开始：“准备好，开始！”
* 听到“开始”信号后，超级英雄会迅速发出 8 次超声波，频率为 40 kHz。它同时启动秒表，准备监听任何回响。
* 如果正前方有障碍物，超声波会撞到它并反弹回来。当超级英雄听到回声时，它停止秒表并记录下时间，同时向 MCU 发送一个高电平信号，告知它已收到回声。
* 最后，为了计算障碍物的距离，超级英雄会用一个简单的公式：将记录的时间除以 2，再乘以声音的传播速度（340m/s）。最终得到的就是障碍物的距离！

这就是我们的超级英雄传感器如何计算路径上是否有障碍物，并且能确定它们距离有多远。是不是很神奇？接下来，我们将学习如何在火星探测车中使用这个超级能力！




超声波测距模块检测值
----------------------------------------------------------

1. 首先， :ref:`app_connect` 。

2. 找到 GalaxyRVR 类别下的 “距离（厘米）” 块，勾选它。

.. image:: img/6_ultrasonic_value.png

3. 这将把测得的值显示在舞台上。

.. image:: img/6_ultrasonic_value2.png

4. 将手在超声波模块前后移动，你会看到你手与模块之间的距离显示在舞台上，单位为厘米。



响应超声波测距模块
--------------------------------------------------------------------

我们可以利用红外避障模块让 GalaxyRVR 自动避开前方的障碍物。

1. 拖动一个绿色旗帜块。

.. image:: img/6_ultrasonic_flag.png

2. 设置移动速度。这里我们将速度设置为 30%，这样可以避免过快，有助于调试。

.. image:: img/6_ultrasonic_speed.png

3. 放置一个前进块，以便在没有障碍物时继续前进。

.. image:: img/6_ultrasonic_forward.png

4. 找到 ``当距离 < 15 cm`` 块。

.. image:: img/6_ultrasonic_when.png

5. 当探测到障碍物时，GalaxyRVR 停止移动并倒退。

.. image:: img/6_ultrasonic_backward.png

6. 做一个小的转向（左转或右转）。

.. image:: img/6_ultrasonic_turn.png

7. 完成转向后，再次前进。

.. image:: img/6_ultrasonic_forward_again.png

现在，将 GalaxyRVR 放在地面上，它将继续前进，直到遇到正前方的障碍物，此时它将改变方向。




与超声波模块相关的代码块
-------------------------------------------------

.. image:: img/block/ultra_when.png

这是一个事件块，当超声波传感器检测到障碍物距离小于 15cm 时触发。你可以：

    * 在下拉菜单中将 ``<`` 改为 ``>``。
    * 修改数字来调整阈值条件。

.. image:: img/block/ultra_wait_until.png

这个代码块会暂停程序，直到超声波传感器检测到障碍物距离大于 15cm，然后继续程序。你可以：

    * 在下拉菜单中将 ``<`` 改为 ``>``。
    * 修改数字来调整阈值条件。

.. image:: img/block/ultra_condition.png

这是一个条件块，如果超声波传感器检测到的距离小于 15cm，则返回 TRUE，否则返回 FALSE。它通常用于像 ``if`` 这样的条件语句块中。你可以：

    * 在下拉菜单中将 ``<`` 改为 ``>``。
    * 修改数字来调整阈值条件。

.. image:: img/block/ultra_value.png

这个代码块会显示当前超声波传感器测量的距离。




与舵机相关的代码块
-------------------------------

.. image:: img/block/servo_set_angle.png

这个代码块用于设置舵机角度，范围是 0 到 180 度（但由于结构限制，实际可用范围是 0 到 135 度）。

.. image:: img/block/servo_increase_angle.png

这个代码块用于增加（或减少）舵机角度，值可以是负数。

.. image:: img/block/servo_value.png

显示舵机当前的角度。
